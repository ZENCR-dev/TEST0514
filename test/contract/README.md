# API å¥‘çº¦æµ‹è¯•è„šæœ¬

## ğŸ“‹ æ¦‚è¿°

æœ¬ç›®å½•åŒ…å«æ–°è¥¿å…°ä¸­åŒ»å¤„æ–¹å¹³å°çš„ API å¥‘çº¦æµ‹è¯•è„šæœ¬ï¼Œç”¨äºéªŒè¯å‰åç«¯ API æ¥å£çš„å…¼å®¹æ€§å’Œè¿é€šæ€§ã€‚

## ğŸš€ å¿«é€Ÿè¿è¡Œ

### å‰ç«¯å›¢é˜ŸéªŒè¯æ­¥éª¤

```bash
# 1. å®‰è£…ä¾èµ–ï¼ˆå¦‚æœå°šæœªå®‰è£…ï¼‰
npm install

# 2. è¿è¡Œå¥‘çº¦æµ‹è¯•
npm run test:contract

# æˆ–è€…ç›´æ¥ä½¿ç”¨ Jest
npx jest --config=test/contract/jest.config.js

# 3. è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
npx jest test/contract/response-format.contract.spec.ts
npx jest test/contract/endpoints.contract.spec.ts
```

### ç¯å¢ƒé…ç½®

```bash
# è®¾ç½® API åŸºç¡€åœ°å€ï¼ˆå¯é€‰ï¼Œé»˜è®¤ä¸º Staging ç¯å¢ƒï¼‰
export API_BASE_URL=https://staging-api.tcm.onrender.com

# è¿è¡Œæµ‹è¯•
npm run test:contract
```

## ğŸ“ æ–‡ä»¶ç»“æ„

```
test/contract/
â”œâ”€â”€ README.md                           # æœ¬è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ jest.config.js                      # Jest é…ç½®æ–‡ä»¶
â”œâ”€â”€ setup.ts                           # æµ‹è¯•ç¯å¢ƒè®¾ç½®
â”œâ”€â”€ response-format.contract.spec.ts    # å“åº”æ ¼å¼é™æ€éªŒè¯
â””â”€â”€ endpoints.contract.spec.ts          # ç«¯ç‚¹è¿é€šæ€§éªŒè¯
```

## ğŸ§ª æµ‹è¯•å†…å®¹

### 1. å“åº”æ ¼å¼é™æ€éªŒè¯ (`response-format.contract.spec.ts`)

éªŒè¯ `output/api-response-samples.json` ä¸­çš„å“åº”æ ·æœ¬ï¼š

- âœ… è®¤è¯æ¨¡å—å“åº”æ ¼å¼ï¼ˆç™»å½•ã€åˆ·æ–°ã€ç”¨æˆ·ä¿¡æ¯ï¼‰
- âœ… è¯å“æ¨¡å—å“åº”æ ¼å¼ï¼ˆåˆ—è¡¨ã€æœç´¢ã€åˆ†é¡µï¼‰
- âœ… é”™è¯¯å“åº”æ ¼å¼ï¼ˆ401ã€404ç­‰ï¼‰
- âœ… v1.2 è§„èŒƒcompliance

### 2. ç«¯ç‚¹è¿é€šæ€§éªŒè¯ (`endpoints.contract.spec.ts`)

å¯¹ Staging ç¯å¢ƒè¿›è¡ŒçœŸå®è¯·æ±‚æµ‹è¯•ï¼š

- ğŸŒ è®¤è¯ç«¯ç‚¹ï¼š`/api/v1/auth/login`, `/api/v1/auth/me`, `/api/v1/auth/refresh`
- ğŸŒ è¯å“ç«¯ç‚¹ï¼š`/api/v1/medicines` (åˆ—è¡¨ã€æœç´¢ã€åˆ†é¡µ)
- ğŸŒ å¥åº·æ£€æŸ¥ï¼š`/health`
- ğŸŒ é”™è¯¯å¤„ç†ï¼š404ã€æ— æ•ˆæ•°æ®å¤„ç†
- ğŸŒ CORS é…ç½®éªŒè¯

## âœ… éªŒæ”¶æ ‡å‡†

å¥‘çº¦æµ‹è¯•é€šè¿‡çš„æ ‡å‡†ï¼š

1. **å“åº”æ ¼å¼æµ‹è¯•**: 100% é€šè¿‡
2. **ç«¯ç‚¹è¿é€šæ€§æµ‹è¯•**: æ ¸å¿ƒç«¯ç‚¹è¿”å›é¢„æœŸçŠ¶æ€ç 
3. **æ— æœåŠ¡å™¨é”™è¯¯**: ä¸åº”å‡ºç° 500ã€502ã€503 é”™è¯¯
4. **æµ‹è¯•æ‰§è¡Œæ—¶é—´**: < 2 åˆ†é’Ÿ

## ğŸ”§ æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

**é—®é¢˜ 1**: æµ‹è¯•è¶…æ—¶
```bash
# è§£å†³æ–¹æ¡ˆï¼šå¢åŠ ç¯å¢ƒå˜é‡æˆ–æ£€æŸ¥ç½‘ç»œè¿æ¥
export API_BASE_URL=https://staging-api.tcm.onrender.com
```

**é—®é¢˜ 2**: è®¤è¯å¤±è´¥
```bash
# è§£å†³æ–¹æ¡ˆï¼šç¡®è®¤ Staging ç¯å¢ƒç”¨æˆ·å­˜åœ¨
# é»˜è®¤æµ‹è¯•å‡­æ®: admin@example.com / password123
```

**é—®é¢˜ 3**: ä¾èµ–ç¼ºå¤±
```bash
# è§£å†³æ–¹æ¡ˆï¼šé‡æ–°å®‰è£…ä¾èµ–
npm install --save-dev supertest @types/supertest
```

### è°ƒè¯•æ¨¡å¼

```bash
# å¯ç”¨è¯¦ç»†æ—¥å¿—
DEBUG=* npm run test:contract

# åªè¿è¡Œå•ä¸ªæµ‹è¯•
npx jest --testNamePattern="ç™»å½•ç«¯ç‚¹è¿é€šæ€§" test/contract/
```

## ğŸ“Š æµ‹è¯•æŠ¥å‘Š

æµ‹è¯•å®Œæˆåï¼Œå°†æ˜¾ç¤ºï¼š

```
API Contract Tests
  âœ“ å“åº”æ ¼å¼é™æ€éªŒè¯ (8 ä¸ªæµ‹è¯•)
  âœ“ ç«¯ç‚¹è¿é€šæ€§éªŒè¯ (12 ä¸ªæµ‹è¯•)
  
æ€»è®¡: 20 ä¸ªæµ‹è¯•ç”¨ä¾‹
é€šè¿‡ç‡: 100%
æ‰§è¡Œæ—¶é—´: < 2 åˆ†é’Ÿ
```

## ğŸš¨ ç´§æ€¥è”ç³»

å¦‚æœå¥‘çº¦æµ‹è¯•å¤±è´¥ï¼š

1. **ç«‹å³é€šçŸ¥**: åœ¨ Slack #frontend-backend-integration é¢‘é“ @åç«¯å›¢é˜Ÿ
2. **æä¾›ä¿¡æ¯**: ç²˜è´´å®Œæ•´çš„é”™è¯¯æ—¥å¿—
3. **é˜»å¡å†³ç­–**: å¦‚æœæµ‹è¯•æœª 100% é€šè¿‡ï¼Œè”è°ƒæš‚åœ

## ğŸ“ å¼€å‘è¯´æ˜

æœ¬å¥‘çº¦æµ‹è¯•åŸºäºï¼š
- **æŠ€æœ¯æ ˆ**: Jest + Supertest + TypeScript
- **è®¾è®¡åŸåˆ™**: é»‘ç›’æµ‹è¯•ï¼Œä¸“æ³¨è¿é€šæ€§å’Œæ ¼å¼éªŒè¯
- **è¦†ç›–èŒƒå›´**: è®¤è¯æ¨¡å— + è¯å“æ¨¡å—ï¼ˆç¬¬ä¸€é˜¶æ®µè”è°ƒèŒƒå›´ï¼‰

æœ€åæ›´æ–°ï¼š2025å¹´6æœˆ19æ—¥ 20:35 NZST 